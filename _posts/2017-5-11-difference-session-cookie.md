---
layout: post
title: "세션과 쿠키 차이점"
description: "세션과 쿠키를 잘못 알고 있다."
tags:
  - "frontend"
  - "cookie"
  - "session"
comments: true
share: true
date: 2017-5-11
---



# 세션과 쿠키



## 배경

먼저 왜 생겼는지 알아보자.
http 요청은 `stateless`하다. 만약 클라이언트(브라우저)가 서버에게 내가 쓴 게시물을 가져오라고 `GET /boards` 라는 요청을 보낸다고 하자. 이 떄, 서버는 요청 만으로는 `내가` 누군지 알 수 없다. 이 때 나에 대한 정보를 가진 쿠키를 요청과 같이 서버로 보내면, 서버는 쿠키를 읽어서 `내가` 누군지 알 수 있다.

즉, 쿠키는 서버와 클라이언트 간의 지속적인 데이터 교환을 위해 만들어졌고, 이로 인해 요청시 서버로 전송된다.

## 쿠키

쿠키와 세션은 서버에서 클라이언트의 상태를 저장하는 수단이다.
쿠키는 만료기한이 있는 `key-value` 저장소다.
쿠키는 항상 클라이언트에 데이터를 저장하는 점이 세션과 다른 점이다.

그런데, 서버에서 클라이언트의 상태를 저장하기 위한 수단이라면서 클라이언트(클라)에 저장하면, 서버에서 그 데이터를 어떻게 확인할까?

### 쿠키 동작 과정

![쿠키](/images/cookie-session/cookie.png)

1. `example.org/boards`로 요청을 보낸다.
2. 서버측에서 받은 요청에 헤더에 쿠키와 관련된 값이 없으므로 쿠키에 id를 생성하여 응답을 보낸다.
	- `set-cookie`에 담아서 보낸다
3. 클라측에서 `set-cookie`에 담긴 값(id, domain)을 저장한다.
4. 요청 보낼 때, 요청 url과 일치하는 domain을 가진 쿠키가 있으면 확인한다.(방금 저장했다.) 그리고 `cookie` 헤더에 담아서 요청을 보낸다.
- `domain` : 쿠키가 유효한 도메인 범위, 즉 요청 보낼 때 요청 url과 일치하는 domain을 가진 cookie만 전송(서버에서 설정하지 않는다면, 요청 보낼 때 자원의 domain과 path를 기본값으로 설정)

서버가 클라에 저장한 쿠키는 다시 서버로 돌아와서 제역할을 할 수 있다.

`쿠키의 단점`은 클라에 저장되기 때문에 **보안에 취약하다는 단점**이 있다.
**이러한 보안을 보완해 주는 것이 `세션`이다.**

## 세션

세션은 서버와 클라의 대화성 통신 또는 대화성 통신을 유지하는 정보를 말한다.
무상태 프로토콜인 HTTP 기반에서 세션을 구현하기 위해

**서버에 `클라이언트의 상태 및 정보`를 저장**한다.
클라이언트에 `session_id`를 저장한다.

세션을 쿠키에 사용하기도 하지만 이것은 세션 스펙에 맞지 않는 사용법이다. 쿠키에 저장할 경우, 세션의 장점인 `보안`을 포기하게 된다.

### 세션 저장 방법

세션을 저장하는 방법은

	- 메모리
	- 파일
	- DB
	- 쿠키

메모리, 파일, DB는 서버측 / 쿠키는 클라측에 세션을 저장하는 방법이다.
만약 부하분산을 위해 한 도메인에 여러대의 서버를 운영한다면, 데이터베이스나 쿠키를 이용해야 한다.
(쿠키는 잘못된 방법이다.)
메모리나 파일은 물리적으로 서버 간에 나누어져있기 때문에 세션이 유지될 수 없다.

### 세션 동작 과정

![session](/images/cookie-session/session.png)

1. 요청을 보낸다.
2. 서버에서는 session을 시작하고, 메모리에 `id = yummy_cookie`를 저장한다. 그 값에 대한 `session_id`도 생성했다. 그리고, `set-cookie`에 `session_id`를 담아 응답을 보낸다.
3. 클라이언트에서 `set-cookie`에 담긴 값을 저장한다.
4. 다시 요청을 보낼 때 요청 url과 일치하는 domain을 가진 session_id를 cookie에 담아 전송한다.
5. 서버에서는 수신한 `session_id`을 통해 클라의 세션을 찾는다. 즉, `session_id`를 통해 서버가 클라이언트를 구분할 수 있다.

> 보안과 httponly 쿠키
보안 쿠키는 SSL과 https 프로토콜을 사용해 만들어진 경우에만 전송된다.
[XSS(Cross-site 스크립팅)](https://ko.wikipedia.org/wiki/%EC%82%AC%EC%9D%B4%ED%8A%B8_%EA%B0%84_%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8C%85) 공격을 방지하기 위해 HTTP-only 쿠키는 `document.cookie` 프로퍼티, `XMLHttpRequest` 그리고 `Request` API를 통해 JS로 접근 불가하다. JS로 쿠키를 이용 할 필요가 없을 경우 이 플래그를 설정해야 한다. **특히, 세션 정의 용도로 쿠키를 사용한다면, JS내에서 쿠키를 사용할 필요가 없으므로 `http only`플래그를 설정하자**

```
Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT; Secure; HttpOnly
```

## Summary

쿠키는 방문자의 상태 및 정보를 클라이언트(브라우저)에 저장한다. 그러므로 보안 취약
세션은 방문자 상태 및 정보를 클라이언트에 저장하는 것이 아닌, 서버에 저장한다. 대신 긴 문자열의 session-id가 클라이언트에 저장된다.

## 참조

[MDN에서 설명 하는 쿠키](https://developer.mozilla.org/ko/docs/Web/HTTP/Cookies)

[http cookie 번역](http://wiki-camp.appspot.com/%5B%EB%B2%88%EC%97%AD%5D_HTTP_Cookie_(Wikipedia)?rev=1)
